<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>PolySonic</title>
  <script src="bower_components/webcomponentsjs/webcomponents.js"></script>
  <script src="bower_components/x-notification/x-notification.js"></script>
  <link href="imports.html" rel="import">
  <link rel="stylesheet" href="styles/PolySonic.css" shim-shadowdom>
</head>
<body>


  <!-- loading screen -->
  <div id="loader">
    <div id="box">
      <img src="../images/icon_128.png" height="128" width="128" alt="Icon">
      <div tyle="height:30px">
        <paper-spinner id="spinner" active=""></paper-spinner>
      </div>
    </div>
  </div>


  <!-- app body -->
  <div unresolved>

    <!-- begin databindings -->
    <template is="auto-binding" id="tmpl">
      
      <style>
        paper-progress::shadow #progressContainer {
          background-color:{{colorThiefProgBg}};
          transition: background 500ms linear;
        }
        paper-progress::shadow #activeProgress {
          background-color:{{colorThiefFab}};
          transition: background 500ms linear;
        }
        paper-progress::shadow #secondaryProgress {
          background-color:{{colorThiefBuffered}};
          transition: background 500ms linear;
        }
      </style>

      <!-- fab -->
      <animated-fab id="fab" page="{{page}}" showing="{{showing}}" on-tap="{{doAction}}" colorThiefFab="{{colorThiefFab}}" colorThiefFabOff="{{colorThiefFabOff}}" colorThiefalbum="{{colorThiefAlbum}}" colorThiefAlbumOff="{{colorThiefAlbumOff}}"></animated-fab>
      <core-drawer-panel id="panel" narrow="{{narrow}}" responsivewidth="191900px" disableSwipe?="{{page !== 0}}">

        <!-- menu -->
        <core-scroll-header-panel drawer flex mode="seamed">
          <core-menu id="menu" selected="{{selected}}" valueattr="i">
            <core-toolbar class="medium-tall"></core-toolbar>
            <div id="sortBox">
              <core-label>
                Folder:
                <paper-dropdown-menu label="All">
                  <paper-dropdown class="dropdown">
                    <core-menu class="menu" selected="{{folder}}" valueattr="i">
                      <paper-item i="" on-tap="{{setFolder}}">All</paper-item>
                      <template repeat="{{mediaFolders}}">
                        <paper-item i="{{id}}" on-tap="{{setFolder}}">{{name}}</paper-item>
                      </template>
                    </core-menu>
                  </paper-dropdown>
                </paper-dropdown-menu>
              </core-label>
            </div>
            <paper-item on-tap="{{shuffleOptions}}">
              <core-icon icon="av:shuffle"></core-icon>
              Shuffle
            </paper-item>
            <paper-item on-tap="{{getArtist}}">
              <core-icon icon="perm-identity"></core-icon>
              Artists List
            </paper-item>
            <template repeat="{{sortTypes}}">
              <paper-item on-tap="{{selectAction}}" i="{{sort}}">
                <core-icon icon="sort"></core-icon>
                {{name}}
              </paper-item>
            </template>
            <paper-item on-tap="{{getPodcast}}">
              <core-icon icon="sort"></core-icon>
              Podcast
            </paper-item>
            <paper-item on-tap="{{getStarred}}">
              <core-icon icon="favorite"></core-icon>
              Favorites
            </paper-item>
            <paper-item on-tap="{{openSearch}}">
              <core-icon icon="search"></core-icon>
              Search
            </paper-item>
            <paper-item on-tap="{{gotoSettings}}">
              <core-icon icon="settings"></core-icon>
              Settings
            </paper-item>
          </core-menu>
        </core-scroll-header-panel>


        <!-- body -->
        <core-header-panel id="headerPanel" main flex mode="seamed">

          <!--app toolbar-->
          <core-toolbar id="toolbar" class="medium-tall">

            <!-- click area to move app -->
            <div flex id='drag'></div>

            <!-- app minimize / close buttons -->
            <paper-icon-button icon="remove" on-tap="{{minimize}}"></paper-icon-button>
            <!--<paper-icon-button id="max" on-tap="{{maximize}}"></paper-icon-button>-->
            <paper-icon-button icon="close" on-tap="{{close}}"></paper-icon-button>

            <!-- logic for toolbar -->
            <template if="{{page === 0}}">
              <paper-icon-button icon="menu" on-tap="{{openPanel}}" class="bottom"></paper-icon-button>
              <div flex  class="bottom alignLeft">PolySonic</div>
              <template if="{{showing === 'cover'}}">
                <paper-icon-button title="Change View" on-tap="{{toggleWall}}" icon="{{view}}" class="bottom"></paper-icon-button>
              </template>
              <template if="{{showing === 'podcast'}}">
                <paper-icon-button title="Refresh Podcast" on-tap="{{refreshPodcast}}" icon="autorenew" class="bottom"></paper-icon-button>
              </template>
            </template>
            <template if="{{page !== 0}}">
              <paper-icon-button class="bottom" icon="arrow-back" on-tap="{{back2List}}"></paper-icon-button>
            </template>
            <template if="{{page === 1}}">
              <div class="bottom" flex>{{currentPlaying}}</div>
            </template>
            <template if="{{page === 3}}">
              <div flex class="bottom"></div>
            </template>
           <template if="{{page === 2}}">
              <div flex class="bottom"></div>
            </template>
           <template if="{{page === 4}}">
              <div flex class="bottom"></div>
            </template>
            <template if="{{page !== 1}}">
              <template if="{{isNowPlaying}}">
                <paper-icon-button title="Now Playing" on-tap="{{nowPlaying}}" icon="av:hearing" class="bottom"></paper-icon-button>
              </template>
            </template>
          </core-toolbar>

          <!-- app main page animations -->
          <core-animated-pages id="main" on-core-animated-pages-transition-prepare="{{fixScroller}}" on-core-animated-pages-transition-end="{{fixScroller}}" selected="{{page}}" >

            <!-- main content album wall, podcast, artist -->
            <section>
              <album-wall id="wall" listMode="{{listMode}}" url="{{url}}" user="{{user}}" pass="{{pass}}" version="{{version}}" bitRate="{{bitRate}}" querySize="{{querySize}}" isLoading="{{isLoading}}" showing="{{showing}}" queryMethod="{{queryMethod}}" mediaFolder="{{folder}}" colorThiefEnabled="{{colorThiefEnabled}}"></album-wall>
            </section>

            <!-- player -->
            <section>
              <div style="position:relative;">
                <div id="coverArt"></div>
                <div class="controlsWrapper">
                  <paper-progress id="progress" value="{{progress}}" secondaryProgress="{{buffer}}" on-tap="{{progressClick}}"></paper-progress>
                  <div id="time">{{playTime}}</div>
                  <template if="{{playlist && playing !== 0}}">
                    <paper-icon-button icon="av:skip-previous" on-tap="{{lastTrack}}" class="big"></paper-icon-button>
                  </template>
                  <template if="{{playlist[0] && playing === 0}}">
                    <paper-icon-button class="big"></paper-icon-button>
                  </template>
                  <paper-icon-button id="avIcon" class="huge" icon="av:pause" on-tap="{{playPause}}"></paper-icon-button>
                  <template if="{{playlist[0]}}">
                    <paper-icon-button icon="av:skip-next" on-tap="{{nextTrack}}" id="nextTrack" class="big"></paper-icon-button>
                  </template>
                  <paper-icon-button id="volume" icon="av:volume-up" on-tap="{{toggleVolume}}"></paper-icon-button>
                </div>
              </div>
            </section>

            <!-- settings menu -->
            <section>
              <paper-shadow z='1' class='card'>
                <settings-menu url="{{url}}" user="{{user}}" pass="{{pass}}" version="{{version}}" bitRate="{{bitRate}}" querySize="{{querySize}}" storageQuota="{{storageQuota}}" queryMethod="{{queryMethod}}" colorThiefEnabled="{{colorThiefEnabled}}"></settings-menu>
              </paper-shadow>
            </section>

            <!-- artist details -->
            <section>
              <artist-details
                id="aDetails"
                listMode="{{listMode}}"
                url="{{url}}"
                user="{{user}}"
                pass="{{pass}}"
                version="{{version}}"
                bitRate="{{bitRate}}"
                colorThiefEnabled="{{colorThiefEnabled}}">
              </artist-details>
            </section>
          </core-animated-pages>
        </core-header-panel>
      </core-drawer-panel>

      <!-- playlist -->
      <paper-dialog id="playlistDialog" style="min-height:695px; min-width:471px;" transition="core-transition-top">
        <div horizontal layout>
          <div flex></div>
          <div>
            <paper-icon-button style='color:#db4437;' icon="close" title="Close" on-tap="{{closePlaylist}}"></paper-icon-button>
          </div>
        </div>
        <div style="position:absolute; top:80px; bottom:0; left:0; right:0; overflow:auto;">
          <paper-item on-tap="{{clearPlaylist}}" style='-webkit-app-region: no-drag;'>
            Clear Play Queue
          </paper-item>
          <core-menu class="menu" id="playlistMenu" selected="{{playing}}">
            <template repeat="{{playlist}}">
              <paper-item on-tap="{{playThis}}" ident="{{id}}" cover="{{cover}}" artist="{{artist}}" title="{{title}}" fab='{{palette[0]}}' offColor="{{palette[1]}}" buffer="{{palette[2]}}" progBg="{{palette[3]}}" style="color:#000000" ident="{{id}}">
                <div flex style="overflow:hidden">
                  {{artist}} - {{title}}
                </div>
                <div style="margin-left:8px">
                  {{duration}}
                </div>
              </paper-item>
            </template>
          </core-menu>
        </div>
      </paper-dialog>

      <!-- want Toast? -->
      <paper-toast id="toast"></paper-toast>

      <!-- volume -->
      <paper-dialog id="volumeDialog" transition="core-transition-bottom">
        Volume
        <br>
        <volume-slider volume="{{volume}}"></volume-slider>
      </paper-dialog>

      <!-- first run login details n such -->
      <paper-action-dialog id="firstRun" style="min-height: 425px;" autoclosedisabled transition="core-transition-center">
        <subsonic-login url="{{url}}" user="{{user}}" pass="{{pass}}" version="{{version}}">
        </subsonic-login>
      </paper-action-dialog>

      <!-- request analistics -->
      <paper-action-dialog id='analistics' autoclosedisabled transition="core-transition-center" layered>
        <h4>Allow anonymous usage tracking?</h4>
        <paper-button affirmative on-tap="{{disAllowAnalistics}}">Decline</paper-button>
        <paper-button affirmative on-tap="{{allowAnalistics}}">Accept</paper-button>
      </paper-action-dialog>

      <!-- search -->
      <paper-dialog id="searchDialog" header="Search" style="height:480px; width:400px;" transition="core-transition-center">
        <div horizontal layout>
          <div flex style="text-align: center;">
            <paper-input value="{{searchQuery}}" style="width: 250px;"></paper-input>
          </div>
          <div>
            <paper-icon-button on-tap="{{doSearch}}" title="Search" icon="search"></paper-icon-button>
            <paper-icon-button style='color:#db4437;' icon="close" title="Close" on-tap="{{closeSearch}}"></paper-icon-button>
          </div>
        </div>
        <div style="position:absolute; top:80px; bottom:0; left:0; right:0; overflow:auto; text-align: center;">
          <template if="{{searching}}">
            <paper-spinner active></paper-spinner>
            <br>
          </template>
          <template if="{{searchResults.artist}}">
            <h3>Artists</h3>
            <template repeat="{{searchResults.artist}}">
              <paper-item on-tap="{{artistDetails}}" i="{{id}}">{{name}}</paper-item>
            </template>
          </template>
          <template if="{{searchResults.album[0]}}">
            <h3>Albums</h3>
            <template repeat="{{searchResults.album}}">
              <album-art listMode="search" bitRate="{{bitRate}}" item="{{id}}" cover="{{coverArt}}" artist="{{artist}}" album="{{name}}" url="{{url}}" user="{{user}}" pass="{{pass}}" version="{{version}}" isFavorite="{{starred}}"></album-art>
            </template>
          </template>
          <!--<template if="{{searchResults.song}}">
            <h3>Songs</h3>
            <template repeat="{{searchResults.song}}">
              <core-item>
                <div flex style="text-align:left; overflow:hidden;">
                  {{title}}
                </div>
                <paper-icon-button icon="av:play-arrow" dismissive="" on-tap="{{playTrack}}" title="{{title}}" artist="{{artist}}" ident="{{id}}" cover="{{cover}}"></paper-icon-button>
                <paper-icon-button on-tap="{{addSingle2Playlist}}" icon="av:playlist-add" title="{{title}}" artist="{{artist}}" ident="{{id}}" cover="{{cover}}"></paper-icon-button>
                <paper-icon-button on-tap="{{doDownload}}" ident="{{id}}"  icon="file-download"></paper-icon-button>
              </core-item>
            </template>
          </template>-->
          <template if="{{!searchResults.artist && !searchResults.album[0] && searchResults.song}}">
            No results matching query
          </template>
        </div>
      </paper-dialog>


      <!-- shuffle options -->
      <paper-dialog id="shuffleOptions" style="height:400px; width:300px;" transition="core-transition-center">
        <div style="text-align:center">
          <core-label>
            <h3>Shuffle Options</h3>
            <core-label>
              Genre:
              <paper-dropdown-menu label="Optional">
                <paper-dropdown layered class="dropdown">
                  <core-menu selected="{{genreFilter}}" valueattr="i" class="menu">
                    <paper-item i="">Optional</paper-item>
                    <template repeat="{{genres}}">
                      <paper-item i="{{value}}">{{value}}</paper-item>
                    </template>
                  </core-menu>
                </paper-dropdown>
              </paper-dropdown-menu>
            </core-label>
            <br>
            <core-label>
              Number of Songs to return:
              <paper-dropdown-menu label="Optional">
                <paper-dropdown layered class="dropdown">
                  <core-menu selected="{{shuffleSize}}" valueattr="i" class="menu">
                    <template repeat="{{shuffleSizes}}">
                      <paper-item i="{{}}">{{}}</paper-item>
                    </template>
                  </core-menu>
                </paper-dropdown>
              </paper-dropdown-menu>
            </core-label>
            <paper-input-decorator id="startYearValidate" autoValidate isInvalid="{{startYearInvalid}}" labelvisible="" floatinglabel="" error="Please enter a valid year" label="Released after: Optional">
              <input is="core-input" type="text" pattern='[0-9]{4}' value="{{startingYear}}">
            </paper-input-decorator>
            <paper-input-decorator id="endYearValidate" autoValidate isInvalid="{{endYearInvalid}}" labelvisible="" floatinglabel="" error="Please enter a valid year" label="Released before: Optional">
              <input is="core-input" type="text" pattern='[0-9]{4}' value="{{endingYear}}">
            </paper-input-decorator>
          </core-label>
          <br>
          <paper-button on-tap="{{shufflePlay}}">
            Play
            <template if="{{shuffleLoading}}">
              <div style="position:absolute; top:0;bottom:0;right:0;left:0;background: rgba(255,255,255,0.7);display: -webkit-box; display: -moz-box; display: -ms-flexbox;display: -webkit-flex; display: flex; -webkit-justify-content: center;-webkit-align-items: center;align-items:center;justify-content:center;">
                <paper-spinner active=""></paper-spinner>
              </div>
            </template>
          </paper-button>
        </div>
      </paper-dialog>

      <!-- add podcast -->
      <paper-dialog id="addPodcast" transition="core-transition-bottom">
        <div style="text-align:center;">
          <paper-input-decorator style="min-width:280px;" id="podcastChannelURL" autoValidate isInvalid="{{invalidURL}}" labelvisible="" floatinglabel="" error="URL Required" label="Podcast feed URL">
            <input is="core-input" type="URL" value="{{castURL}}" required="">
          </paper-input-decorator>
          <paper-button on-tap="{{addChannel}}">
            Submit
            <template if="{{addingChannel}}">
              <div style="position:absolute; top:0;bottom:0;right:0;left:0;background: rgba(255,255,255,0.7);display: -webkit-box; display: -moz-box; display: -ms-flexbox;display: -webkit-flex; display: flex; -webkit-justify-content: center;-webkit-align-items: center;align-items:center;justify-content:center;">
                <paper-spinner active=""></paper-spinner>
              </div>
            </template>
          </paper-button>
        </div>
      </paper-dialog>

      <!-- delete confirmation podcast channel -->
      <paper-action-dialog id='confirmDelete' autoclosedisabled transition="core-transition-center" layered>
        <div style="min-width:280px"></div>
        <h4>Are You Sure? Delete Channel</h4>
        <paper-button affirmative>Decline</paper-button>
        <paper-button affirmative ident="{{delID}}" on-tap="{{doDelete}}">Accept</paper-button>
      </paper-action-dialog>

      <!-- delete confirmation podcast episodes  -->
      <paper-action-dialog id='episodeConfirm' autoclosedisabled transition="core-transition-center" layered>
        <div style="min-width:280px"></div>
        <h4>Are You Sure? Delete Episode</h4>
        <paper-button affirmative>Decline</paper-button>
        <paper-button affirmative ident="{{delID}}" on-tap="{{deleteEpisode}}">Accept</paper-button>
      </paper-action-dialog>

      <!--some key bindings ** half ass working** -->
      <core-a11y-keys keys="space" on-keys-pressed="{{playPause}}"></core-a11y-keys>
      <core-a11y-keys keys="left" on-keys-pressed="{{lastTrack}}"></core-a11y-keys>
      <core-a11y-keys keys="right"on-keys-pressed="{{nextTrack}}"></core-a11y-keys>
      <core-a11y-keys keys="up" on-keys-pressed="{{volUp}}"></core-a11y-keys>
      <core-a11y-keys keys="down" on-keys-pressed="{{volDown}}"></core-a11y-keys>
      <x-notification id="playNotify" timeout='5000' tag="tag"></x-notification>

      <!-- where the magic happens -->
      <audio id="audio"></audio>
    </template>
  </div>
  <script src="js/cast_sender.js"></script>
  <script src="js/PolySonic.js"></script>
  <script src="js/google-analytics-bundle.js"></script>
  <script src="js/color-thief.min.js"></script>
</body>
