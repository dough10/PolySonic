/*! subsonic-api 2016-07-02 */
function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.SubsonicAPI=function(){function a(a,b){var g=a[0],h=a[1],i=a[2],j=a[3];g=c(g,h,i,j,b[0],7,-680876936),j=c(j,g,h,i,b[1],12,-389564586),i=c(i,j,g,h,b[2],17,606105819),h=c(h,i,j,g,b[3],22,-1044525330),g=c(g,h,i,j,b[4],7,-176418897),j=c(j,g,h,i,b[5],12,1200080426),i=c(i,j,g,h,b[6],17,-1473231341),h=c(h,i,j,g,b[7],22,-45705983),g=c(g,h,i,j,b[8],7,1770035416),j=c(j,g,h,i,b[9],12,-1958414417),i=c(i,j,g,h,b[10],17,-42063),h=c(h,i,j,g,b[11],22,-1990404162),g=c(g,h,i,j,b[12],7,1804603682),j=c(j,g,h,i,b[13],12,-40341101),i=c(i,j,g,h,b[14],17,-1502002290),h=c(h,i,j,g,b[15],22,1236535329),g=d(g,h,i,j,b[1],5,-165796510),j=d(j,g,h,i,b[6],9,-1069501632),i=d(i,j,g,h,b[11],14,643717713),h=d(h,i,j,g,b[0],20,-373897302),g=d(g,h,i,j,b[5],5,-701558691),j=d(j,g,h,i,b[10],9,38016083),i=d(i,j,g,h,b[15],14,-660478335),h=d(h,i,j,g,b[4],20,-405537848),g=d(g,h,i,j,b[9],5,568446438),j=d(j,g,h,i,b[14],9,-1019803690),i=d(i,j,g,h,b[3],14,-187363961),h=d(h,i,j,g,b[8],20,1163531501),g=d(g,h,i,j,b[13],5,-1444681467),j=d(j,g,h,i,b[2],9,-51403784),i=d(i,j,g,h,b[7],14,1735328473),h=d(h,i,j,g,b[12],20,-1926607734),g=e(g,h,i,j,b[5],4,-378558),j=e(j,g,h,i,b[8],11,-2022574463),i=e(i,j,g,h,b[11],16,1839030562),h=e(h,i,j,g,b[14],23,-35309556),g=e(g,h,i,j,b[1],4,-1530992060),j=e(j,g,h,i,b[4],11,1272893353),i=e(i,j,g,h,b[7],16,-155497632),h=e(h,i,j,g,b[10],23,-1094730640),g=e(g,h,i,j,b[13],4,681279174),j=e(j,g,h,i,b[0],11,-358537222),i=e(i,j,g,h,b[3],16,-722521979),h=e(h,i,j,g,b[6],23,76029189),g=e(g,h,i,j,b[9],4,-640364487),j=e(j,g,h,i,b[12],11,-421815835),i=e(i,j,g,h,b[15],16,530742520),h=e(h,i,j,g,b[2],23,-995338651),g=f(g,h,i,j,b[0],6,-198630844),j=f(j,g,h,i,b[7],10,1126891415),i=f(i,j,g,h,b[14],15,-1416354905),h=f(h,i,j,g,b[5],21,-57434055),g=f(g,h,i,j,b[12],6,1700485571),j=f(j,g,h,i,b[3],10,-1894986606),i=f(i,j,g,h,b[10],15,-1051523),h=f(h,i,j,g,b[1],21,-2054922799),g=f(g,h,i,j,b[8],6,1873313359),j=f(j,g,h,i,b[15],10,-30611744),i=f(i,j,g,h,b[6],15,-1560198380),h=f(h,i,j,g,b[13],21,1309151649),g=f(g,h,i,j,b[4],6,-145523070),j=f(j,g,h,i,b[11],10,-1120210379),i=f(i,j,g,h,b[2],15,718787259),h=f(h,i,j,g,b[9],21,-343485551),a[0]=l(g,a[0]),a[1]=l(h,a[1]),a[2]=l(i,a[2]),a[3]=l(j,a[3])}function b(a,b,c,d,e,f){return b=l(l(b,a),l(d,f)),l(b<<e|b>>>32-e,c)}function c(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)}function d(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)}function e(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)}function f(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)}function g(b){txt="";var c=b.length,d=[1732584193,-271733879,-1732584194,271733878],e=void 0;for(e=64;e<=b.length;e+=64)a(d,h(b.substring(e-64,e)));b=b.substring(e-64);var f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<b.length;e++)f[e>>2]|=b.charCodeAt(e)<<(e%4<<3);if(f[e>>2]|=128<<(e%4<<3),e>55)for(a(d,f),e=0;16>e;e++)f[e]=0;return f[14]=8*c,a(d,f),d}function h(a){var b=[],c=void 0;for(c=0;64>c;c+=4)b[c>>2]=a.charCodeAt(c)+(a.charCodeAt(c+1)<<8)+(a.charCodeAt(c+2)<<16)+(a.charCodeAt(c+3)<<24);return b}function i(a){for(var b="",c=0;4>c;c++)b+=m[a>>8*c+4&15]+m[a>>8*c&15];return b}function j(a){for(var b=0;b<a.length;b++)a[b]=i(a[b]);return a.join("")}function k(a){return j(g(a))}function l(a,b){return a+b&4294967295}var m="0123456789abcdef".split("");"5d41402abc4b2a76b9719d911017c592"!=k("hello"),String.prototype.hexEncode=function(){for(var a="",b=0,c=void 0;b<this.length;){for(c=this.charCodeAt(b++).toString(16);c.length<2;)c=c;a+=c}return"enc:"+a};var n=function(){function a(b){var c=this;if(_classCallCheck(this,a),"object"!=typeof b)throw new Error("Input must be an object & contain url, user, password & appName fields");if(!(b.hasOwnProperty("ip")&&b.hasOwnProperty("port")&&b.hasOwnProperty("user")&&b.hasOwnProperty("password")&&b.hasOwnProperty("appName")&&b.hasOwnProperty("https")))throw new TypeError("Input must be an object & contain url, user, password & appName fields");b.md5Auth||(b.md5Auth=!0),this.params={u:b.user,f:"json",c:b.appName},this._user=b.user,this._md5Auth=b.md5Auth,this._url=function(){var a=void 0;switch(b.port){case 80:a="";break;case 443:a="";break;default:a=":"+b.port}return b.https?"https://"+b.ip+a:"http://"+b.ip+a}(),this._password=b.password,this._fishVersion(this._url).then(function(a){c.params.v=a,c.ping().then(function(a){if("ok"===a.status)c.getUserInfo().then(function(b){var c=new CustomEvent("subsonicApi-ready",{detail:{status:a.status,user:b}});document.dispatchEvent(c)});else{var b=new CustomEvent("subsonicApi-ready",{detail:{status:a.status,error:a.error.messsage}});document.dispatchEvent(b)}})},function(){throw new TypeError("Error attempting to fetch subsonic version from given address")})}return _createClass(a,[{key:"_toQueryString",value:function(a){var b=[];for(var c in a)c=encodeURIComponent(c),b.push(null===a[c]?c:c+"="+encodeURIComponent(a[c]));return b.join("&")}},{key:"_buildUrl",value:function(a,b){return null!==b&&"object"==typeof b&&(b="&"+this._toQueryString(b)),b||(b=""),this._versionCompare(this.params.v,"1.13.0")>=0&&this._md5Auth?(this.params.p&&delete this.params.p,this.params.s=this._makeSalt(6),this.params.t=k(this._password+this.params.s),this._url+"/rest/"+a+".view?"+this._toQueryString(this.params)+b):(this.params.t&&delete this.params.t,this.params.s&&delete this.params.s,this.params.p=this._password.hexEncode(),this._url+"/rest/"+a+".view?"+this._toQueryString(this.params)+b)}},{key:"_xhr",value:function(a,b){var c=this;return new Promise(function(d,e){var f=new XMLHttpRequest;f.open("GET",a,!0),f.responseType=b||"json",f.onload=d,f.onerror=e,f.send(),c._lastXhr=f})}},{key:"_makeSalt",value:function(a){for(var b="",c="ABCD/EFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b}},{key:"_fishVersion",value:function(a){var b=this;return new Promise(function(c,d){b._xhr(a+"/rest/ping.view?f=json").then(function(a){var b=a.target.response["subsonic-response"];c(b.version)},d)})}},{key:"_versionCompare",value:function(a,b,c){function d(a){return(e?/^\d+[A-Za-z]*$/:/^\d+$/).test(a)}var e=c&&c.lexicographical,f=c&&c.zeroExtend,g=a.split("."),h=b.split(".");if(!g.every(d)||!h.every(d))return NaN;if(f){for(;g.length<h.length;)g.push("0");for(;h.length<g.length;)h.push("0")}e||(g=g.map(Number),h=h.map(Number));for(var i=0;i<g.length;++i){if(h.length==i)return 1;if(g[i]!=h[i])return g[i]>h[i]?1:-1}return g.length!=h.length?-1:0}},{key:"getUserInfo",value:function(){var a=this;return new Promise(function(b,c){var d=a._buildUrl("getUser",{username:a._user});a._xhr(d).then(function(c){a.userPermissions=c.target.response["subsonic-response"].user,b(a.userPermissions)})})}},{key:"abort",value:function(){this._lastXhr&&this._lastXhr.abort()}},{key:"ping",value:function(){var a=this;return new Promise(function(b,c){var d=a._buildUrl("ping");a._xhr(d).then(function(a){var c=a.target.response["subsonic-response"];b(c)},function(a){c(a)})})}},{key:"getPlaylist",value:function(a){var b=this;return new Promise(function(c,d){var e=b._buildUrl(function(){return a?"getPlaylist":"getPlaylists"}(),function(){return a?{id:a}:void 0}());b._xhr(e).then(function(a){var b=a.target.response["subsonic-response"].playlists;c(function(){return b.hasOwnProperty("playlist")?b.playlist:[]}())},d)})}},{key:"getMusicFolders",value:function(){var a=this;return new Promise(function(b,c){var d=a._buildUrl("getMusicFolders");a._xhr(d).then(function(a){var c=a.target.response["subsonic-response"].musicFolders.musicFolder;b(c)},c)})}},{key:"getIndexes",value:function(a){var b=this;return new Promise(function(c,d){var e=b._buildUrl("getIndexes",function(a){return a?{musicFolderId:a}:void 0}(a));b._xhr(e).then(function(a){var b=a.target.response["subsonic-response"].indexes.index;c(b)},d)})}},{key:"getMusicDirectory",value:function(a){var b=this;return new Promise(function(c,d){if(!a)throw new Error("id required");var e=b._buildUrl("getMusicDirectory",{id:a});b._xhr(e).then(function(a){var b=a.target.response["subsonic-response"].directory;c(b)},d)})}},{key:"getArtists",value:function(){var a=this;return new Promise(function(b,c){var d=a._buildUrl("getArtists");a._xhr(d).then(function(a){var c=a.target.response["subsonic-response"].artists.index;b(c)})})}},{key:"getArtist",value:function(a){var b=this;return new Promise(function(c,d){var e=b._buildUrl("getArtist",{id:a});b._xhr(e).then(function(a){var b=a.target.response["subsonic-response"].artist;b.album.sort(function(a,b){return a.discNumber-b.discNumber||a.track-b.track}),c(b)})})}},{key:"streamUrl",value:function(a,b){if(!a)throw new Error("id required");return this._buildUrl("stream",{id:a,maxBitRate:b||320,estimateContentLength:!0})}},{key:"downloadUrl",value:function(a){if(!a)throw new Error("id required");return this._buildUrl("download",{id:a})}},{key:"getTopSongs",value:function(a,b){var c=this;return new Promise(function(d,e){if(!a)throw new Error("artist name is required");var f=c._buildUrl("getTopSongs",{count:b||50,artist:a});c._xhr(f).then(function(a){var b=a.target.response["subsonic-response"].topSongs.song;d(b)},e)})}},{key:"getGenres",value:function(){var a=this;return new Promise(function(b,c){var d=a._buildUrl("getGenres");a._xhr(d).then(function(a){var c=a.target.response["subsonic-response"].genres.genre;b(c)},c)})}},{key:"getAlbum",value:function(a){var b=this;return new Promise(function(c,d){if(!a)throw new Error("id required");var e=b._buildUrl("getAlbum",{id:a});b._xhr(e).then(function(a){var b=a.target.response["subsonic-response"].album;c(b)},d)})}},{key:"getAlbumList",value:function(a,b,c,d){var e=this;return new Promise(function(f,g){if(!a)throw new Error("sort method required");var h={size:b||60,offset:c||0,type:a};d&&(h.musicFolderId=d);var i=e._buildUrl("getAlbumList",h);e._xhr(i).then(function(a){var b=a.target.response["subsonic-response"].albumList.album;f(b)},g)})}},{key:"getAlbumList2",value:function(a,b,c,d){var e=this;return new Promise(function(f,g){if(!a)throw new Error("sort method required");var h={size:b||60,offset:c||0,type:a};d&&(h.musicFolderId=d);var i=e._buildUrl("getAlbumList2",h);e._xhr(i).then(function(a){var b=a.target.response["subsonic-response"].albumList2.album;f(b)},g)})}},{key:"getArtistInfo",value:function(a,b){var c=this;return new Promise(function(d,e){if(!a){var f=new Error("id required");throw f}var g=c._buildUrl("getArtistInfo",{id:a,count:b||60});c._xhr(g).then(function(a){var b=a.target.response["subsonic-response"].artistInfo;d(b)},e)})}},{key:"getArtistInfo2",value:function(a,b){var c=this;return new Promise(function(d,e){if(!a){var f=new Error("id required");throw f}var g=c._buildUrl("getArtistInfo2",{id:a,count:b||60});c._xhr(g).then(function(a){var b=a.target.response["subsonic-response"].artistInfo2;d(b)},e)})}},{key:"getSimilarSongs",value:function(a,b){var c=this;return new Promise(function(d,e){if(!a){var f=new Error("id required");throw f}var g=c._buildUrl("getSimilarSongs",{id:a,count:b||60});c._xhr(g).then(function(a){var b=a.target.response["subsonic-response"].similarSongs;d(b)},e)})}},{key:"getSimilarSongs2",value:function(a,b){var c=this;return new Promise(function(d,e){if(!a){var f=new Error("id required");throw f}var g=c._buildUrl("getSimilarSongs2",{id:a,count:b||60});c._xhr(g).then(function(a){var b=a.target.response["subsonic-response"].similarSongs2;d(b)},e)})}},{key:"getSong",value:function(a){var b=this;return new Promise(function(c,d){if(!a){var e=new Error("id required");throw e}var f=b._buildUrl("getSong",{id:a});b._xhr(f).then(function(a){var b=a.target.response["subsonic-response"];c(b)},d)})}},{key:"getStarred",value:function(a){var b=this;return new Promise(function(c,d){var e=b._buildUrl("getStarred",function(){return a?{musicFolderId:a}:void 0}());b._xhr(e).then(function(a){var b=a.target.resolve["subsonic-response"].starred;c(b)},d)})}},{key:"getStarred2",value:function(a){var b=this;return new Promise(function(c,d){var e=b._buildUrl("getStarred2",function(){return a?{musicFolderId:a}:void 0}());b._xhr(e).then(function(a){var b=a.target.resolve["subsonic-response"].starred2;c(b)},d)})}},{key:"getCoverArt",value:function(a,b){var c=this;return new Promise(function(d,e){if(!a){var f=new Error("id required");throw f}var g=c._buildUrl("getCoverArt",{id:a,size:b||500});c._xhr(g,"blob").then(function(a){var b=a.target.response;d(b)},e)})}},{key:"star",value:function(a){var b=this;return new Promise(function(c,d){if(!a){var e=new Error("id required");throw e}var f=b._buildUrl("star",{id:a});b._xhr(f).then(function(a){var b=a.target.response["subsonic-response"];c(b)},d)})}},{key:"unstar",value:function(a){var b=this;return new Promise(function(c,d){if(!a){var e=new Error("id required");throw e}var f=b._buildUrl("unstar",{id:a});b._xhr(f).then(function(a){var b=a.target.response["subsonic-response"];c(b)},d)})}},{key:"setRating",value:function(a,b){var c=this;return new Promise(function(d,e){if(!a){var f=new Error("id required");throw f}var g=c._buildUrl("setRating",{id:a,rating:b});c._xhr(g).then(function(a){var b=a.target.response["subsonic-response"];d(b)},e)})}},{key:"scrobble",value:function(a){var b=this;return new Promise(function(c,d){if(!a){var e=new Error("id required");throw e}var f=b._buildUrl("scrobble",{id:a,time:(new Date).getTime()});b._xhr(f).then(function(a){var b=a.target.response["subsonic-response"];c(b)},d)})}},{key:"search",value:function(a){var b=this;return new Promise(function(c,d){if(!a){var e=new Error("search object required");return void d(e)}var f=b._buildUrl("search",a);b._xhr(f).then(function(a){var b=a.target.response["subsonic-response"].searchResult.match;c(b)},d)})}},{key:"search2",value:function(a){var b=this;return new Promise(function(c,d){if(!a){var e=new Error("search object required");return void d(e)}var f=b._buildUrl("search2",a);b._xhr(f).then(function(a){var b=a.target.response["subsonic-response"].search2Result.match;c(b)},d)})}},{key:"search3",value:function(a){var b=this;return new Promise(function(c,d){if(!a){var e=new Error("search object required");return void d(e)}var f=b._buildUrl("search3",a);b._xhr(f).then(function(a){var b=a.target.response["subsonic-response"].search3Result.match;c(b)},d)})}}]),a}();return n}();